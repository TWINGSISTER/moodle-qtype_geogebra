define ("qtype_geogebra/ggbq",["jquery","//www.geogebra.org/apps/deployggb.js"],function(a,b){return{b64input:[],ggbBase64:[],xmlinput:[],ggbxml:[],currentvals:[],answerinput:[],responsevars:[],exerciseresultinput:[],qdiv:[],ggbDataset:[],init:function init(c){window.GGBQ=this;var d=document.getElementById(c).dataset,e=d.slot;window.ggbAppletOnLoad=function(a){if(-1!=a){document.querySelector("article").onkeydown=this.checkEnter;var b=a.substring(9),c=window[a];for(var d in window.GGBQ.currentvals[b]){c.setValue(d,window.GGBQ.currentvals[b][d])}window.GGBQ.b64input[b].val(c.getBase64());window.GGBQ.xmlinput[b].val(c.getXML());var e=c.startExercise();for(var f in e){window.GGBQ.qdiv[b].innerHTML=window.GGBQ.qdiv[b].innerHTML.replace("{"+f+"}",e[f])}window.GGBQ.qdiv[b].style.visibility="visible";if(""==window.GGBQ.answerinput[b].val()){var g="";window.GGBQ.responsevars[b].forEach(function(a){if(c.isDefined(a)){g+=c.getValue(a)}else{g+=0}});window.GGBQ.answerinput[b].val(g)}}};this.b64input[e]=a(document.getElementById(d.b64input));this.ggbBase64[e]=this.b64input[e].val();this.xmlinput[e]=a(document.getElementById(d.xmlinput));this.ggbxml[e]=this.xmlinput[e].val();this.qdiv[e]=a("#q"+e+" .qtext")[0];var f=JSON.parse(d.parameters);if(""!=this.ggbBase64[e]){f.ggbBase64=this.ggbBase64[e]}var g=f.height/f.width;if(0<g){f.width=a(".qtext").parent().width();f.height=f.width*g}f.language=d.lang;f.moodle="takingQuiz";delete f.material_id;f.id="ggbApplet"+e;var h=JSON.parse(d.views),i=new b(f,h,d.html5NoWebSimple);i.setHTML5Codebase("https://cdn.geogebra.org/apps/5.0.541.0/web3d");i.inject(d.div,"preferHTML5");a("#responseform").on("submit",this.getBase64andCheck);a(document.getElementById(d.div)).on("mouseleave",this.getBase64andCheck);this.currentvals[e]=d.vars;this.answerinput[e]=a(document.getElementById(d.answerinput));this.exerciseresultinput[e]=a(document.getElementById(d.exerciseresultinput));this.responsevars[e]=JSON.parse(d.responsevars)},checkEnter:function checkEnter(a){a=a||event;var b=/textarea/i.test((a.target||a.srcElement).tagName);return b||13!==(a.keyCode||a.which||a.charCode||0)},getBase64andCheck:function getBase64andCheck(){for(var a=0,b;a<window.GGBQ.answerinput.length;a++){b=window["ggbApplet"+a];if("undefined"!=typeof b){window.GGBQ.b64input[a].val(b.getBase64());window.GGBQ.xmlinput[a].val(b.getXML());for(var c="",d=0;d<window.GGBQ.responsevars[a].length;d++){if(b.isDefined(window.GGBQ.responsevars[a][d])){c+=b.getValue(window.GGBQ.responsevars[a][d])}else{c+=0}}window.GGBQ.answerinput[a].val(c);window.GGBQ.exerciseresultinput[a].val(JSON.stringify(b.getExerciseResult()))}}}}});
//# sourceMappingURL=ggbq.min.js.map
