{"version":3,"sources":["../src/ggbq.js"],"names":["define","$","GGBApplet","b64input","ggbBase64","xmlinput","ggbxml","currentvals","answerinput","responsevars","exerciseresultinput","qdiv","ggbDataset","init","appletParametersID","window","GGBQ","document","getElementById","dataset","slot","ggbAppletOnLoad","ggbAppletId","querySelector","onkeydown","checkEnter","id","substring","ggbApplet","curvals","JSON","parse","label","setValue","val","getBase64","getXML","numvars","startExercise","key","innerHTML","replace","style","visibility","responsestring","forEach","responsevar","isDefined","getValue","parameters","aspectratio","height","width","parent","ggbDatasetVars","vars","language","lang","moodle","material_id","views","applet1","html5NoWebSimple","inject","div","on","getBase64andCheck","e","event","txtArea","test","target","srcElement","tagName","keyCode","which","charCode","i","length","Object","entries","value","evalCommand","j","stringify","getExerciseResult"],"mappings":"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","sourcesContent":["/**\n * Javascript Controller to embed GGBApplet\n *\n * This class provides all the functionality for the new assign module.\n *\n * @package        assignsubmission_geogebra\n * @author         Christoph Stadlbauer <christoph.stadlbauer@geogebra.org>\n * @copyright  (c) International GeoGebra Institute 2018\n * @license        http://www.geogebra.org/license\n */\ndefine(['jquery', '//www.geogebra.org/apps/deployggb.js'], function ($, GGBApplet) {\n    /**\n     * Created by Christoph on 25.08.19.\n     */\n\n    return {\n        b64input: [],\n        ggbBase64: [],\n        xmlinput: [],\n        ggbxml: [],\n        currentvals: [],\n        answerinput: [],\n        responsevars: [],\n        exerciseresultinput: [],\n        qdiv: [],\n        //parameters: {},\n        ggbDataset: [],\n        //applet1,\n\n        init: function (appletParametersID) {\n            window.GGBQ = this;\n\n            var ggbDataset = document.getElementById(appletParametersID).dataset;\n            var slot = ggbDataset.slot;\n\n            window.ggbAppletOnLoad = function (ggbAppletId) {\n                if (ggbAppletId != -1) {\n                    document.querySelector('article').onkeydown = this.checkEnter;\n                    var id = ggbAppletId.substring(9);\n                    var ggbApplet = window[ggbAppletId];\n                    var curvals = JSON.parse(window.GGBQ.currentvals[id]);\n                    for (var label in curvals) {\n                        ggbApplet.setValue(label, curvals[label]);\n                    }\n                    window.GGBQ.b64input[id].val(ggbApplet.getBase64());\n                    window.GGBQ.xmlinput[id].val(ggbApplet.getXML());\n                    var numvars = ggbApplet.startExercise();\n                    for (var key in numvars) {\n                        window.GGBQ.qdiv[id].innerHTML =\n                            window.GGBQ.qdiv[id].innerHTML.replace(\"{\" + key + \"}\", numvars[key]);\n                    }\n                    window.GGBQ.qdiv[id].style.visibility = 'visible';\n\n                    if (window.GGBQ.answerinput[id].val() == '') {\n                        var responsestring = '';\n                        window.GGBQ.responsevars[id].forEach(function (responsevar) {\n                            if (ggbApplet.isDefined(responsevar)) {\n                                responsestring += ggbApplet.getValue(responsevar);\n                            } else {\n                                responsestring += 0;\n                            }\n                        });\n                        window.GGBQ.answerinput[id].val(responsestring);\n                    }\n                }\n            };\n\n            // jquery doesn't handle the colon : but later we expect a jquery optject, so ...\n            this.b64input[slot] = $(document.getElementById(ggbDataset.b64input));\n            this.ggbBase64[slot] = this.b64input[slot].val();\n\n            this.xmlinput[slot] = $(document.getElementById(ggbDataset.xmlinput));\n            this.ggbxml[slot] = this.xmlinput[slot].val();\n            this.qdiv[slot] = $(\"#q\" + (slot) + \" .qtext\")[0];\n\n            var parameters = JSON.parse(ggbDataset.parameters);\n            if (this.ggbBase64[slot] != '') {\n                parameters.ggbBase64 = this.ggbBase64[slot];\n            }\n\n            // To adjust the width of the ggbApplet to the available area.\n            var aspectratio = parameters.height / parameters.width;\n            if (aspectratio > 0) {\n                parameters.width = $(\".qtext\").parent().width();\n                parameters.height = parameters.width * aspectratio;\n            }\n\n            // parameters.currentvals = JSON.parse(ggbDataset.vars);\n            this.ggbDatasetVars = JSON.parse(ggbDataset.vars);\n            parameters.language = ggbDataset.lang;\n            parameters.moodle = \"takingQuiz\";\n            delete parameters.material_id;\n\n            parameters.id = 'ggbApplet' + slot;\n\n            var views = JSON.parse(ggbDataset.views);\n\n            var applet1 = new GGBApplet(parameters, views, ggbDataset.html5NoWebSimple);\n            // applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.541.0/web3d\");\n            applet1.inject(ggbDataset.div, \"preferHTML5\");\n\n            $('#responseform').on('submit', this.getBase64andCheck);\n\n            $(document.getElementById(ggbDataset.div)).on('mouseleave', this.getBase64andCheck);\n\n            this.currentvals[slot] = ggbDataset.vars;\n            this.answerinput[slot] = $(document.getElementById(ggbDataset.answerinput));\n            this.exerciseresultinput[slot] = $(document.getElementById(ggbDataset.exerciseresultinput));\n            this.responsevars[slot] = JSON.parse(ggbDataset.responsevars);\n        },\n        checkEnter: function(e) {\n            e = e || event;\n            var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);\n            return txtArea || (e.keyCode || e.which || e.charCode || 0) !== 13;\n        },\n\n\n        getBase64andCheck: function() {\n            for (var i = 0; i < window.GGBQ.answerinput.length; i++) {\n                var ggbApplet = window['ggbApplet' + i];\n                if (typeof ggbApplet !== \"undefined\") {\n                    window.GGBQ.b64input[i].val(ggbApplet.getBase64());\n                    window.GGBQ.xmlinput[i].val(ggbApplet.getXML());\n\n                    // Workaround, to set all randomized variables.\n                    for (const [key, value] of Object.entries(window.GGBQ.ggbDatasetVars)) {\n                        ggbApplet.evalCommand(`${key}=${value}`);\n                    }\n\n                    var responsestring = '';\n                    for (var j = 0; j < window.GGBQ.responsevars[i].length; j++) {\n                        if (ggbApplet.isDefined(window.GGBQ.responsevars[i][j])) {\n                            responsestring += ggbApplet.getValue(window.GGBQ.responsevars[i][j]);\n                        } else {\n                            responsestring += 0;\n                        }\n                    }\n\n                    window.GGBQ.answerinput[i].val(responsestring);\n                    window.GGBQ.exerciseresultinput[i].val(JSON.stringify(ggbApplet.getExerciseResult()));\n                }\n            }\n        },\n\n    };\n});\n"],"file":"ggbq.min.js"}