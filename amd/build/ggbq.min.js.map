{"version":3,"sources":["../src/ggbq.js"],"names":["define","$","GGBApplet","b64input","ggbBase64","xmlinput","ggbxml","currentvals","answerinput","responsevars","exerciseresultinput","qdiv","ggbDataset","init","appletParametersID","window","GGBQ","document","getElementById","dataset","slot","ggbAppletOnLoad","ggbAppletId","querySelector","onkeydown","checkEnter","id","substring","ggbApplet","label","setValue","val","getBase64","getXML","numvars","startExercise","key","innerHTML","replace","style","visibility","responsestring","forEach","responsevar","isDefined","getValue","parameters","JSON","parse","aspectratio","height","width","parent","language","lang","moodle","material_id","views","applet1","html5NoWebSimple","setHTML5Codebase","inject","div","on","getBase64andCheck","vars","e","event","txtArea","test","target","srcElement","tagName","keyCode","which","charCode","i","length","j","stringify","getExerciseResult"],"mappings":"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","sourcesContent":["/**\n * Javascript Controller to embed GGBApplet\n *\n * This class provides all the functionality for the new assign module.\n *\n * @package        assignsubmission_geogebra\n * @author         Christoph Stadlbauer <christoph.stadlbauer@geogebra.org>\n * @copyright  (c) International GeoGebra Institute 2018\n * @license        http://www.geogebra.org/license\n */\ndefine(['jquery', '//www.geogebra.org/apps/deployggb.js'], function ($, GGBApplet) {\n    /**\n     * Created by Christoph on 25.08.19.\n     */\n\n    return {\n        b64input: [],\n        ggbBase64: [],\n        xmlinput: [],\n        ggbxml: [],\n        currentvals: [],\n        answerinput: [],\n        responsevars: [],\n        exerciseresultinput: [],\n        qdiv: [],\n        //parameters: {},\n        ggbDataset: [],\n        //applet1,\n\n        init: function (appletParametersID) {\n            window.GGBQ = this;\n\n            var ggbDataset = document.getElementById(appletParametersID).dataset;\n            var slot = ggbDataset.slot;\n\n            window.ggbAppletOnLoad = function (ggbAppletId) {\n                if (ggbAppletId != -1) {\n                    document.querySelector('article').onkeydown = this.checkEnter;\n                    var id = ggbAppletId.substring(9);\n                    var ggbApplet = window[ggbAppletId];\n                    for (var label in window.GGBQ.currentvals[id]) {\n                        ggbApplet.setValue(label, window.GGBQ.currentvals[id][label]);\n                    }\n                    window.GGBQ.b64input[id].val(ggbApplet.getBase64());\n                    window.GGBQ.xmlinput[id].val(ggbApplet.getXML());\n                    var numvars = ggbApplet.startExercise();\n                    for (var key in numvars) {\n                        window.GGBQ.qdiv[id].innerHTML =\n                            window.GGBQ.qdiv[id].innerHTML.replace(\"{\" + key + \"}\", numvars[key]);\n                    }\n                    window.GGBQ.qdiv[id].style.visibility = 'visible';\n\n                    if (window.GGBQ.answerinput[id].val() == '') {\n                        var responsestring = '';\n                        window.GGBQ.responsevars[id].forEach(function (responsevar) {\n                            if (ggbApplet.isDefined(responsevar)) {\n                                responsestring += ggbApplet.getValue(responsevar);\n                            } else {\n                                responsestring += 0;\n                            }\n                        });\n                        window.GGBQ.answerinput[id].val(responsestring);\n                    }\n                }\n            };\n\n            // jquery doesn't handle the colon : but later we expect a jquery optject, so ...\n            this.b64input[slot] = $(document.getElementById(ggbDataset.b64input));\n            this.ggbBase64[slot] = this.b64input[slot].val();\n\n            this.xmlinput[slot] = $(document.getElementById(ggbDataset.xmlinput));\n            this.ggbxml[slot] = this.xmlinput[slot].val();\n            this.qdiv[slot] = $(\"#q\" + (slot) + \" .qtext\")[0];\n\n            var parameters = JSON.parse(ggbDataset.parameters);\n            if (this.ggbBase64[slot] != '') {\n                parameters.ggbBase64 = this.ggbBase64[slot];\n            }\n\n            // To adjust the width of the ggbApplet to the available area.\n            var aspectratio = parameters.height / parameters.width;\n            if (aspectratio > 0) {\n                parameters.width = $(\".qtext\").parent().width();\n                parameters.height = parameters.width * aspectratio;\n            }\n\n            parameters.language = ggbDataset.lang;\n            parameters.moodle = \"takingQuiz\";\n            delete parameters.material_id;\n\n            parameters.id = 'ggbApplet' + slot;\n\n            var views = JSON.parse(ggbDataset.views);\n\n            var applet1 = new GGBApplet(parameters, views, ggbDataset.html5NoWebSimple);\n            applet1.setHTML5Codebase(\"https://cdn.geogebra.org/apps/5.0.541.0/web3d\");\n            applet1.inject(ggbDataset.div, \"preferHTML5\");\n\n            $('#responseform').on('submit', this.getBase64andCheck);\n\n            $(document.getElementById(ggbDataset.div)).on('mouseleave', this.getBase64andCheck);\n\n            this.currentvals[slot] = ggbDataset.vars;\n            this.answerinput[slot] = $(document.getElementById(ggbDataset.answerinput));\n            this.exerciseresultinput[slot] = $(document.getElementById(ggbDataset.exerciseresultinput));\n            this.responsevars[slot] = JSON.parse(ggbDataset.responsevars);\n        },\n        checkEnter: function(e) {\n            e = e || event;\n            var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);\n            return txtArea || (e.keyCode || e.which || e.charCode || 0) !== 13;\n        },\n\n\n        getBase64andCheck: function() {\n            for (var i = 0; i < window.GGBQ.answerinput.length; i++) {\n                var ggbApplet = window['ggbApplet' + i];\n                if (typeof ggbApplet !== \"undefined\") {\n                    window.GGBQ.b64input[i].val(ggbApplet.getBase64());\n                    window.GGBQ.xmlinput[i].val(ggbApplet.getXML());\n\n                    var responsestring = '';\n                    for (var j = 0; j < window.GGBQ.responsevars[i].length; j++) {\n                        if (ggbApplet.isDefined(window.GGBQ.responsevars[i][j])) {\n                            responsestring += ggbApplet.getValue(window.GGBQ.responsevars[i][j]);\n                        } else {\n                            responsestring += 0;\n                        }\n                    }\n\n                    window.GGBQ.answerinput[i].val(responsestring);\n                    window.GGBQ.exerciseresultinput[i].val(JSON.stringify(ggbApplet.getExerciseResult()));\n                }\n            }\n        },\n\n    };\n});\n"],"file":"ggbq.min.js"}